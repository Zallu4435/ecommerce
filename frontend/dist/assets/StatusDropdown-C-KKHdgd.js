import{r as l,j as r,bv as C,bw as j,aL as N,B as m}from"./index-DNwfBDY0.js";import R from"./index-BBTKOM0z.js";const p={Pending:{color:"bg-gray-100 text-gray-700",next:["Confirmed","Cancelled"]},Confirmed:{color:"bg-indigo-100 text-indigo-700",next:["Processing","Cancelled"]},Processing:{color:"bg-yellow-100 text-yellow-700",next:["Packed","Cancelled"]},Packed:{color:"bg-orange-100 text-orange-700",next:["Shipped","Cancelled"]},Shipped:{color:"bg-blue-100 text-blue-700",next:["Out for Delivery","Cancelled"]},"Out for Delivery":{color:"bg-blue-200 text-blue-900",next:["Delivered","Failed"]},Delivered:{color:"bg-green-100 text-green-700",next:["Returned"]},"Return Requested":{color:"bg-purple-50 text-purple-600",next:["Returned","Delivered"]},Returned:{color:"bg-purple-100 text-purple-700",next:[]},Cancelled:{color:"bg-red-100 text-red-700",next:[]},Refunded:{color:"bg-green-100 text-green-800",next:[]},Failed:{color:"bg-red-50 text-red-700",next:["Processing","Cancelled"]}},D=({currentStatus:d,orderId:y,itemIds:h,onUpdate:x,onStatusChange:i,isLoading:w})=>{const[c,s]=l.useState(!1),[v,f]=l.useState(!1),u=l.useRef(null),o=w||v;l.useEffect(()=>{const e=t=>{u.current&&!u.current.contains(t.target)&&s(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const k=async e=>{var t,a;if(e!==d&&!(["Cancelled","Returned"].includes(e)&&!i&&!window.confirm(`Are you sure you want to change status to ${e}? This will trigger any applicable refunds.`))){if(i){i(e),s(!1);return}try{f(!0),(await R.patch(`${N}/orders/update-bulk`,{orderId:y,status:e,itemsIds:h},{withCredentials:!0})).status===200&&(m.success(`Status updated to ${e}`),x&&x())}catch(g){console.error("Status update failed:",g),m.error(((a=(t=g.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update status")}finally{f(!1),s(!1)}}},b=p[d]||p.Pending,n=b.next;return r.jsxs("div",{className:"relative inline-block text-left w-full min-w-[140px]",ref:u,children:[r.jsxs("button",{type:"button",onClick:e=>{e.stopPropagation(),!o&&n.length>0&&s(!c)},disabled:o||n.length===0,className:`flex items-center justify-between w-full px-3 py-1.5 text-[11px] font-bold rounded-full transition-all border border-transparent shadow-sm ${b.color} ${o?"opacity-70 cursor-wait":n.length===0?"cursor-default":"hover:shadow-md cursor-pointer border-gray-200 dark:border-gray-600"}`,children:[r.jsxs("span",{className:"flex items-center gap-1.5 uppercase tracking-wider",children:[o?r.jsx(C,{className:"animate-spin",size:10}):r.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-current opacity-50"}),d]}),n.length>0&&!o&&r.jsx(j,{className:`ml-1 transition-transform ${c?"rotate-180":""}`,size:10})]}),c&&r.jsx("div",{className:"absolute right-0 mt-1 w-44 rounded-xl shadow-2xl bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 z-[70] overflow-hidden animate-in fade-in slide-in-from-top-1 duration-200",onClick:e=>e.stopPropagation(),children:r.jsxs("div",{className:"p-1.5",children:[r.jsx("div",{className:"px-3 py-2 text-[10px] uppercase font-black text-gray-400 dark:text-gray-500 mb-1 border-b border-gray-50 dark:border-gray-700/50",children:"Update Status"}),n.map(e=>{var t,a;return r.jsxs("button",{type:"button",onClick:()=>k(e),className:"flex items-center w-full px-2.5 py-2 text-xs font-semibold text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg transition-colors group/item",children:[r.jsx("div",{className:`w-2 h-2 rounded-full mr-2.5 ${(a=(t=p[e])==null?void 0:t.color)==null?void 0:a.split(" ")[0]}`}),e]},e)})]})})]})};export{p as S,D as a};
