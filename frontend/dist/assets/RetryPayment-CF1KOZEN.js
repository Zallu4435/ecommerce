import{n as j,ag as M,u as O,r as b,aR as S,aS as L,aT as $,B as o,j as e}from"./index-DNwfBDY0.js";import{C as B}from"./circle-alert-ogbMB1Si.js";import{A}from"./arrow-left-CUel7EGd.js";import{C as E,B as T}from"./credit-card-TwjS0omd.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=j("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=j("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),Y=()=>{const N=M(),l=O(),{orderId:n,amount:d}=N.state||{},[a,u]=b.useState(""),[i,m]=b.useState(!1),{data:y,isLoading:p}=S(n,{skip:!n}),[P]=L(),[z]=$(),s=(y==null?void 0:y.order)||y;b.useEffect(()=>{n?s&&s.paymentStatus==="Successful"&&(o.info("This order has already been paid for."),l("/profile/order")):(o.error("Invalid access. Please select an order to retry payment."),l("/profile/order"))},[n,l,s]);const C=()=>new Promise(t=>{const r=document.createElement("script");r.src="https://checkout.razorpay.com/v1/checkout.js",r.onload=()=>t(!0),r.onerror=()=>t(!1),document.body.appendChild(r)}),R=async(t,r)=>{var g,f,v;if(!await C()){o.error("Razorpay SDK failed to load. Please try again later.");return}const I={key:"rzp_test_S0cXdT2gxTqG7n",amount:Math.round(t*100),currency:"INR",name:"VAGO University",description:"Retry Payment for Order",order_id:r,handler:async function(c){try{const k=await z({razorpay_payment_id:c.razorpay_payment_id,razorpay_order_id:c.razorpay_order_id,razorpay_signature:c.razorpay_signature,orderId:n,amount:t}).unwrap();o.success("Payment successful!"),l("/payment-success",{state:{orderId:n,paymentId:c.razorpay_payment_id}})}catch(k){console.error("Payment verification failed:",k),o.error("Payment verification failed. Please contact support.")}},modal:{ondismiss:function(){o.warning("Payment cancelled. You can retry anytime."),m(!1)},escape:!0,backdropclose:!1},prefill:{name:((g=s==null?void 0:s.user)==null?void 0:g.name)||"",email:((f=s==null?void 0:s.user)==null?void 0:f.email)||"",contact:((v=s==null?void 0:s.user)==null?void 0:v.phone)||""},theme:{color:"#3399cc"}},h=new window.Razorpay(I);h.on("payment.failed",function(c){console.error("Razorpay payment failed:",c.error),o.error(c.error.description||"Payment failed. Please try again."),m(!1)}),h.open()},_=async()=>{var t;if(!a){o.info("Please select a payment method");return}if(a==="cod"&&d>2500){o.error("COD is not available for orders above ₹2500");return}try{m(!0);const r=await P({orderId:n,paymentMethod:a}).unwrap();if(a==="razorpay"){await R(d,r.razorpayOrderId);return}r.paymentStatus==="Successful"?(o.success("Payment successful!"),l("/payment-success",{state:{orderId:n,paymentId:r.paymentId}})):a==="cod"&&(o.success("Order updated to Cash on Delivery!"),l("/payment-success",{state:{orderId:n,paymentId:r.paymentId,isCOD:!0}}))}catch(r){console.error("Retry payment error:",r);const x=((t=r==null?void 0:r.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Failed to process payment. Please try again.";o.error(x),x.includes("Insufficient wallet balance")&&o.info("Please add money to your wallet or choose a different payment method.")}finally{m(!1)}};return p?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading order details..."})]})}):!s&&!p?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8 max-w-md text-center",children:[e.jsx(B,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Order Not Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"We couldn't find this order. It may have been cancelled or doesn't exist."}),e.jsx("button",{onClick:()=>l("/profile/order"),className:"w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition",children:"View My Orders"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-2xl",children:[e.jsxs("button",{onClick:()=>l(-1),className:"flex items-center text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white mb-6 transition",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),"Back"]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-green-700 p-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Retry Payment"}),e.jsx("p",{className:"text-green-100",children:"Complete your order payment"})]}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-xl p-6 mb-8 text-center border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Amount to Pay"}),e.jsxs("p",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600",children:["₹",(d==null?void 0:d.toFixed(2))||"0.00"]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["Order ID: ",n==null?void 0:n.slice(0,8).toUpperCase()]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Select Payment Method"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:`flex items-center p-4 border-2 rounded-xl cursor-pointer transition-all ${a==="card"?"border-blue-600 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-700 hover:bg-gray-50 dark:hover:bg-gray-700/50"}`,children:[e.jsx("input",{type:"radio",name:"payment",value:"wallet",checked:a==="wallet",onChange:t=>u(t.target.value),className:"mr-4 w-5 h-5 text-blue-600"}),e.jsx(V,{className:`w-6 h-6 mr-3 ${a==="wallet"?"text-blue-600":"text-gray-400"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"Wallet"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Pay using your wallet balance"})]})]}),e.jsxs("label",{className:`flex items-center p-4 border-2 rounded-xl cursor-pointer transition-all ${a==="razorpay"?"border-blue-600 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-700 hover:bg-gray-50 dark:hover:bg-gray-700/50"}`,children:[e.jsx("input",{type:"radio",name:"payment",value:"razorpay",checked:a==="razorpay",onChange:t=>u(t.target.value),className:"mr-4 w-5 h-5 text-blue-600"}),e.jsx(E,{className:`w-6 h-6 mr-3 ${a==="razorpay"?"text-blue-600":"text-gray-400"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"Razorpay"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Credit/Debit Card, UPI, Net Banking"})]})]}),e.jsxs("label",{className:`flex items-center p-4 border-2 rounded-xl cursor-pointer transition-all ${d>2500?"opacity-50 cursor-not-allowed":a==="cod"?"border-blue-600 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-700 hover:bg-gray-50 dark:hover:bg-gray-700/50"}`,children:[e.jsx("input",{type:"radio",name:"payment",value:"cod",checked:a==="cod",onChange:t=>u(t.target.value),disabled:d>2500,className:"mr-4 w-5 h-5 text-blue-600 disabled:cursor-not-allowed"}),e.jsx(T,{className:`w-6 h-6 mr-3 ${a==="cod"?"text-blue-600":"text-gray-400"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"Cash on Delivery"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:d>2500?"Not available for orders above ₹2500":"Pay when you receive"})]})]})]})]}),a&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[a==="wallet"&&"Make sure you have sufficient balance in your wallet.",a==="razorpay"&&"You'll be redirected to Razorpay's secure payment gateway.",a==="cod"&&"You can pay in cash when the order is delivered."]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:_,disabled:i||!a,className:`w-full py-4 rounded-xl font-semibold text-lg transition-all ${i||!a?"bg-gray-300 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-green-600 to-green-700 text-white hover:from-green-700 hover:to-green-800 shadow-lg hover:shadow-xl transform hover:scale-[1.02] active:scale-[0.98]"}`,children:i?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(w,{className:"w-5 h-5 animate-spin mr-2"}),"Processing..."]}):"Confirm Payment"}),e.jsx("button",{onClick:()=>l("/profile/order"),disabled:i,className:"w-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white py-3 rounded-xl hover:bg-gray-300 dark:hover:bg-gray-600 transition font-medium disabled:opacity-50",children:"Cancel"})]})]})]})]})})};export{Y as default};
