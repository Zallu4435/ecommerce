import{n as E,r as i,j as e,bB as L,X as U}from"./index-DNwfBDY0.js";import{C as F}from"./index.module-DWjB8usZ.js";import{P}from"./pencil-Dn6gjtjM.js";import{U as z}from"./upload-D2_odXxp.js";import"./tslib.es6-D2mrdk48.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=E("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),B=(l,r,u=0)=>{const n=new Image;return n.src=l,new Promise(o=>{n.onload=()=>{const a=document.createElement("canvas"),c=a.getContext("2d");a.width=r.width,a.height=r.height,c.translate(a.width/2,a.height/2),c.rotate(u*(Math.PI/180)),c.translate(-a.width/2,-a.height/2),c.drawImage(n,r.x,r.y,r.width,r.height,0,0,r.width,r.height);const d=a.toDataURL("image/jpeg");o(d)}})},O=({imageToCrop:l,updateAvatar:r,closeModal:u})=>{const[n,o]=i.useState(null),[a,c]=i.useState({x:0,y:0}),[d,j]=i.useState(1),[m,w]=i.useState(0),g=f=>{try{return new URL(f).hostname.includes("cloudinary")}catch{return!1}},v=(f,h)=>{g(l)||B(l,h,m).then(C=>{o(C)})},N=()=>{g(l)?r(l):r(n),u()};return e.jsxs("div",{className:"p-4",children:[g(l)?e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-700 mb-4",children:"This image is already uploaded to Cloudinary. Cropping is not required."}),e.jsx("img",{src:l,alt:"Cloudinary Image",className:"w-64 h-64 object-contain mx-auto"})]}):e.jsx("div",{className:"relative w-full h-[60vh]",children:e.jsx(F,{image:l,crop:a,zoom:d,aspect:1,rotation:m,onCropChange:c,onZoomChange:j,onRotationChange:w,onCropComplete:v})}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("button",{className:"bg-red-600 text-white px-4 py-2 rounded",onClick:u,children:"Cancel"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:N,children:"Save"})]})]})},H=({isOpen:l,onClose:r,onImageUpload:u,initialImages:n})=>{const[o,a]=i.useState([null,null,null]);i.useEffect(()=>{const s=Array.isArray(n)?n:[null,null,null];a(s.map(t=>t?{url:t.url,isExisting:!0}:null))},[l,n]);const[c,d]=i.useState(new Array(3).fill(null)),[j,m]=i.useState(!1),[w,g]=i.useState(null),[v,N]=i.useState(null);i.useEffect(()=>{const s=o.map(t=>t instanceof File?URL.createObjectURL(t):t&&typeof t.url=="string"?t.url:t&&t.file instanceof File?URL.createObjectURL(t.file):null);return d(s),()=>s.forEach(t=>{t&&typeof t!="string"&&URL.revokeObjectURL(t)})},[o]);const f=s=>{const t=atob(s.split(",")[1]),x=new ArrayBuffer(t.length),p=new Uint8Array(x);for(let y=0;y<t.length;y++)p[y]=t.charCodeAt(y);const b=new Blob([p],{type:"image/jpeg"}),A=new File([b],"cropped-image.jpg",{type:"image/jpeg"}),I=[...o];I[w]={file:A,isExisting:!1},a(I),m(!1)},h=(s,t)=>{const x=t.target.files[0];if(x){const p=[...o];p[s]={file:x,isExisting:!1};const b=[...c];b[s]=URL.createObjectURL(x),d(b),a(p)}},C=()=>{const s=o.map(t=>t?t.isExisting?t.url:t.file:null);u(s),r()},k=s=>{const t=[...o];t[s]=null,a(t)},R=s=>{g(s),N(c[s]),m(!0)},S=()=>{const s=Array.isArray(n)?n:[null,null,null];a(s.map(t=>t?{url:t.url,isExisting:!0}:null)),d(new Array(3).fill(null)),r()};return e.jsxs(e.Fragment,{children:[l&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"w-11/12 max-w-xl bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-6 relative",children:[e.jsx("button",{onClick:S,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700 dark:hover:text-white",children:e.jsx(U,{size:24})}),e.jsx("h2",{className:"text-2xl font-bold mb-6 text-center dark:text-gray-200",children:"Upload Product Images"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:[0,1,2].map(s=>e.jsx("div",{className:"aspect-square border-2 border-dashed rounded-lg flex flex-col items-center justify-center relative",children:c[s]?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:c[s],alt:`Preview ${s+1}`,className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{onClick:()=>k(s),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(U,{size:16})}),e.jsx("button",{className:"absolute -bottom-3 left-0 right-0 m-auto w-fit p-[.35rem] rounded-full bg-gray-800 hover:bg-gray-700 border border-gray-600",title:"Edit photo",onClick:()=>R(s),children:e.jsx(P,{className:"text-white"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",accept:"image/*","aria-label":`Upload image ${s+1}`,onChange:t=>h(s,t),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),e.jsx(M,{size:40,className:"text-gray-400 mb-2"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Upload Image ",s+1]})]})},s))}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsxs("button",{onClick:C,className:"flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700",children:[e.jsx(z,{size:20}),o.every(s=>s===null)?"Confirm No Images":"Upload Images"]})})]})}),j&&L.createPortal(e.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-lg bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl",children:e.jsx(O,{imageToCrop:v,updateAvatar:f,closeModal:()=>m(!1)})})}),document.body)]})};export{H as default};
