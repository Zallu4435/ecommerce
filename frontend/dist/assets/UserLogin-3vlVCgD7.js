import{S as L,r as l,_ as z,u as B,$ as D,a0 as U,a1 as $,a2 as V,j as e,a3 as F,a4 as I,B as g,a5 as _,a6 as A,a7 as H,H as K,a8 as q,f as Z,I as J,a9 as Q,aa as W,ab as X}from"./index-DNwfBDY0.js";const G=L.string().trim().min(1,{message:"Email is required"}).max(254,{message:"Email is too long"}).email({message:"Invalid email address"}),Y=L.string().min(8,{message:"Password must be at least 8 characters"}).max(64,{message:"Password must not exceed 64 characters"}).regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\w\s])[ -~]+$/,{message:"Password must include upper, lower, number and symbol, and contain no spaces or emojis"}),ee=L.object({email:G,password:Y}),se=L.object({email:G}),te=L.object({email:G}),ae=({isOpen:S,change:i,onClose:v})=>{const[x,C]=l.useState(["","","",""]),[s,y]=l.useState(30),[o,k]=l.useState(""),j=l.useRef([]),[p]=z(),P=B(),b=D(),[N]=U(),[M]=$(),h=V(r=>r.user.otpToken),d=V(r=>r.user.forgot_email);l.useEffect(()=>{if(s>0){const r=setInterval(()=>{y(t=>t<=1?(clearInterval(r),0):t-1)},1e3);return()=>clearInterval(r)}},[s]);const O=(r,t)=>{const{value:n}=r.target,a=[...x];a[t]=n,C(a),t<x.length-1&&n&&j.current[t+1].focus()},E=(r,t)=>{r.key==="Backspace"&&!x[t]&&t>0&&j.current[t-1].focus()},u=async()=>{var t,n;const r=x.join("");try{if(i==="otp"){const a=await p({token:h,otp:r}).unwrap();b(I({user:a.user,token:a.accessToken})),g.success("Login successful!"),P("/"),b(F(null)),v()}else if(i==="forget-password"){const a=await N({token:h,otp:r}).unwrap();g.success("OTP verified successfully!"),b(_(a.resetToken)),P("/reset-password",{state:{token:a.resetToken}}),v()}}catch(a){console.error("OTP Verification Error:",a),k(((t=a==null?void 0:a.data)==null?void 0:t.message)||"Invalid OTP"),g.error(((n=a==null?void 0:a.data)==null?void 0:n.message)||"Invalid OTP")}},T=async()=>{await M({email:d}).unwrap(),g.info("OTP has been resent!"),y(30)},R=()=>{b(F(null)),v()};return S?e.jsx("div",{className:"fixed inset-0 flex justify-center items-center bg-black bg-opacity-50 z-50 dark:bg-opacity-80",children:e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 p-10 rounded-2xl max-w-lg w-full shadow-2xl text-center",children:[e.jsx("p",{className:"font-bold text-black dark:text-white cursor-pointer",onClick:R,children:"Back to email"}),e.jsx("h2",{className:"text-3xl font-extrabold text-black dark:text-white mb-6",children:i==="otp"?"Enter Login OTP":"Enter Password Reset OTP"}),e.jsx("div",{className:"flex justify-center mb-8 space-x-4",children:x.map((r,t)=>e.jsx("input",{ref:n=>j.current[t]=n,type:"text",maxLength:"1",value:r,onChange:n=>O(n,t),onKeyDown:n=>E(n,t),className:"w-12 h-12 text-2xl text-center text-black dark:text-white bg-gray-200 dark:bg-gray-700 rounded-lg shadow-lg focus:outline-none focus:ring-2 focus:ring-purple-500"},t))}),o&&e.jsx("div",{className:"text-red-500 dark:text-red-400 mb-4",children:o}),e.jsx("button",{onClick:u,className:"bg-purple-500 text-white py-3 px-6 rounded-lg hover:bg-purple-600 transition duration-300 shadow-lg mb-4",children:"Verify OTP"}),e.jsx("div",{children:e.jsx("button",{onClick:T,disabled:s>0,className:`mt-4 ${s>0?"bg-gray-500":"bg-yellow-500"} text-white py-2 px-4 rounded-lg transition duration-300`,children:s>0?`Resend OTP in ${s}s`:"Resend OTP"})})]})}):null},oe=()=>{const S=B(),i=D(),[v]=A(),[x]=H(),[C]=$(),[s,y]=l.useState(1),[o,k]=l.useState(!1),[j,p]=l.useState(""),[P,b]=l.useState(!1),[N,M]=l.useState(!1),[h,d]=l.useState(""),{register:O,handleSubmit:E,formState:{errors:u},reset:T}=K({resolver:J(s===1?ee:s===2?se:te)}),R=async(f,m)=>{var c;k(!0);try{if(s===1){p("Logging in...");const w=await v(f).unwrap();i(I(w.user,w.accessToken)),g.success("Login Successful"),S("/")}else(s===2||s===3)&&(p("Sending OTP..."),await t(f))}catch(w){(c=w==null?void 0:w.data)!=null&&c.message?d(w.data.message):d("An unexpected error occurred. Please try again."),setTimeout(()=>{d(null)},5e3)}finally{k(!1),p("")}},r=async f=>{k(!0),p("Logging in with Google...");try{const m=await x(f).unwrap();i(I(m.user,m.accessToken)),g.success("Login Successfull"),S("/")}catch(m){g.error("Google Login Failed"),console.error("Google Login Failed:",m)}finally{k(!1),p("")}},t=async f=>{var m;try{i(X(f.email));const c=await C({email:f.email}).unwrap();i(F(c.token)),b(!0),g.success("OTP sent to your email!")}catch(c){(m=c==null?void 0:c.data)!=null&&m.message?d(c.data.message):d("Failed to send OTP"),setTimeout(()=>{d(null)},5e3)}},n=()=>{b(!1),i(F(null))},a=()=>{switch(s){case 1:return e.jsxs("form",{onSubmit:E(R),className:"lg:space-y-6 space-y-3 md:mb-4 mb-3",children:[e.jsxs("div",{className:"relative",children:[h&&e.jsx("p",{className:"text-red-400 font-bold text-sm mb-3 mt-[-5px]",children:h}),e.jsx("input",{type:"email",...O("email"),className:"w-full lg:p-4 p-3 md:p-4 rounded-lg border dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your Email",disabled:o}),u.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.email.message})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:N?"text":"password",...O("password"),className:"w-full lg:p-4 p-3 md:p-4 rounded-lg border dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10",placeholder:"Enter your Password",disabled:o}),e.jsx("button",{type:"button",onClick:()=>M(!N),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 focus:outline-none","aria-label":N?"Hide password":"Show password",children:N?e.jsx(Q,{className:"w-5 h-5"}):e.jsx(W,{className:"w-5 h-5"})}),u.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.password.message})]}),e.jsx("button",{type:"submit",className:"w-full p-3 font-semibold dark:bg-blue-600 bg-blue-500 text-white rounded-lg dark:hover:bg-blue-700 hover:bg-blue-600 transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm sm:text-base disabled:opacity-50 disabled:cursor-not-allowed",disabled:o,children:o?j:"Login"})]});case 2:case 3:return e.jsxs("form",{onSubmit:E(R),className:"md:space-y-6 space-y-3",children:[e.jsxs("div",{className:"relative",children:[h&&e.jsx("p",{className:"text-red-400 font-bold text-sm mb-3 mt-[-5px]",children:h}),e.jsx("input",{type:"email",...O("email"),className:"w-full p-4 rounded-lg border dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:s===2?"Enter your Email for OTP":"Enter your Email to Reset Password",disabled:o}),u.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.email.message})]}),e.jsx("button",{type:"submit",className:"w-full py-3 font-semibold dark:bg-blue-600 bg-blue-500 text-white rounded-lg dark:hover:bg-blue-700 hover:bg-blue-600 transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm sm:text-base disabled:opacity-50 disabled:cursor-not-allowed",disabled:o,children:o?j:s===2?"Send OTP":"Send Reset OTP"})]});default:return null}};return e.jsxs("div",{className:"dark:bg-gray-900 bg-gray-50 flex mt-[-100px] md:mt-0 items-center justify-center min-h-screen lg:p-6",children:[e.jsxs("div",{className:"w-[90%] md:w-[60%] sm:w-full lg:w-[30%] dark:bg-gray-800 bg-white p-8 rounded-lg shadow-xl",children:[e.jsx("h2",{className:"text-3xl font-semibold text-center dark:text-gray-100 text-gray-800 mb-8",children:s===1?"Login":s===2?"OTP Login":"Reset Password"}),a(),s===1&&!o&&e.jsxs(e.Fragment,{children:[e.jsx(q,{onSuccess:r,onError:()=>console.log("Google Login Failed"),useOneTap:!0,className:"google-button mt-4",disabled:o}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("p",{className:"md:text-lg text-green-500 text-sm font-bold dark:text-blue-400 cursor-pointer",onClick:()=>{y(2),T()},children:"Login with OTP"})})]}),s!==1&&!o&&e.jsx("div",{className:"text-center mt-4",children:e.jsx("p",{className:"text-blue-500 text-sm md:text-lg cursor-pointer hover:underline",onClick:()=>{y(1),T()},children:"Back to Login"})}),!o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-center mt-4 text-xs md:text-lg dark:text-gray-300 text-black font-semibold",children:e.jsxs("p",{children:["Don't have an account?"," ",e.jsx(Z,{to:"/signup",className:"text-blue-500 dark:text-blue-400 hover:underline",children:"Sign Up"})]})}),s!==3&&e.jsx("div",{className:"text-center mt-1 text-xs md:text-lg dark:text-red-400 text-red-700 font-semibold",children:e.jsxs("p",{children:["Forgot your password?"," ",e.jsx("span",{onClick:()=>{y(3),T()},className:"text-blue-500 mr-2 dark:text-blue-400 hover:underline cursor-pointer",children:"Reset it here"})]})})]})]}),P&&e.jsx(ae,{isOpen:P,change:s===2?"otp":"forget-password",onClose:n})]})};export{oe as default};
