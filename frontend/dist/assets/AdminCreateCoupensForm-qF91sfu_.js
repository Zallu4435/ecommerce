import{u as J,be as K,r as i,aU as X,bf as Y,H as Z,j as e,at as c,aw as _,I as $,B as w}from"./index-DNwfBDY0.js";import{I as n,L as l,a as m,T as ee}from"./StyledComponents-BbiIQNic.js";import{U as te,P as se,c as re}from"./ProductModal-BfXuxU-a.js";import{A as ae}from"./arrow-left-CUel7EGd.js";import"./tslib.es6-D2mrdk48.js";import"./usePreventBodyScroll-D2l0Zfsl.js";import"./users-nAU_wbTa.js";import"./package-CJrhpnXf.js";const ue=()=>{const S=J(),[C]=K(),[v,g]=i.useState(!1),[P,h]=i.useState(!1),[U,j]=i.useState(!1),[x,b]=i.useState([]),[u,y]=i.useState([]),[A,L]=i.useState(1),[M,I]=i.useState(1),[E,F]=i.useState(!0),[T,H]=i.useState(!0),{data:f=[],isFetching:O}=X({page:A,limit:20}),{data:N=[],isFetching:R}=Y({page:M,limit:20}),{control:d,handleSubmit:B,formState:{errors:r}}=Z({resolver:$(re),defaultValues:{couponCode:"",title:"",description:"",discount:"",minAmount:"",maxAmount:"",expiry:"",usageLimit:"",perUserLimit:1,applicableUsers:[],applicableProducts:[]}}),G=async t=>{var a;g(!0);try{const s=new Date(t.expiry),p=new Date;if(p.setHours(0,0,0,0),!(s instanceof Date)||isNaN(s)||s<=p){w.error("Expiry must be a future date"),g(!1);return}const o={...t,discount:parseFloat(t.discount),minAmount:parseFloat(t.minAmount),maxAmount:parseFloat(t.maxAmount),usageLimit:t.usageLimit?parseInt(t.usageLimit):null,perUserLimit:t.perUserLimit?parseInt(t.perUserLimit):1,applicableUsers:x.map(k=>k.userId),applicableProducts:u.map(k=>k.productId)};await C({entity:"coupons",data:o}).unwrap(),w.success("Coupon created successfully"),S(-1)}catch(s){console.error("Error during form submission:",s),w.error(((a=s==null?void 0:s.data)==null?void 0:a.message)||"An error occurred")}finally{g(!1)}},Q=(t,a)=>{b(s=>s.some(o=>o.userId===t)?s.filter(o=>o.userId!==t):[...s,{userId:t,username:a}])},W=(t,a)=>{y(s=>s.some(o=>o.productId===t)?s.filter(o=>o.productId!==t):[...s,{productId:t,productName:a}])},D=t=>{b(a=>a.filter(s=>s.userId!==t))},V=t=>{y(a=>a.filter(s=>s.productId!==t))},q=i.useCallback(t=>{L(t),t>1&&F(!1)},[]),z=i.useCallback(t=>{I(t),t>1&&H(!1)},[]);return e.jsx("div",{className:"dark:bg-black min-h-screen flex mt-10 items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-[1300px] dark:bg-gray-900 bg-orange-50 p-6 md:p-8 shadow-md",children:[e.jsxs("div",{className:"flex justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold dark:text-gray-400 text-gray-700",children:"Create Coupon"}),e.jsxs("button",{onClick:()=>S(-1),className:"flex items-center text-gray-600 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",children:[e.jsx(ae,{className:"mr-2"}),e.jsx("span",{children:"Back to Coupons"})]})]}),e.jsxs("form",{onSubmit:B(G),children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-4",children:[e.jsxs(n,{children:[e.jsx(l,{className:"text-gray-700 dark:text-white",children:"Coupon Code *"}),e.jsx(c,{name:"couponCode",control:d,render:({field:t})=>e.jsx(m,{...t,type:"text",placeholder:"e.g., WELCOME50",className:"dark:text-white dark:bg-gray-800 uppercase"})}),r.couponCode&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.couponCode.message})]}),e.jsxs(n,{children:[e.jsx(l,{className:"text-gray-700 dark:text-white",children:"Coupon Title *"}),e.jsx(c,{name:"title",control:d,render:({field:t})=>e.jsx(m,{...t,type:"text",placeholder:"e.g., Welcome Offer",className:"dark:text-white dark:bg-gray-800"})}),r.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.title.message})]}),e.jsxs(n,{children:[e.jsx(l,{className:"text-gray-700 dark:text-white",children:"Expiry Date *"}),e.jsx(c,{name:"expiry",control:d,render:({field:t})=>e.jsx(m,{...t,type:"date",min:new Date().toISOString().split("T")[0],className:"dark:text-white dark:bg-gray-800"})}),r.expiry&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.expiry.message})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs(n,{children:[e.jsx(l,{className:"text-gray-700 dark:text-white",children:"Description *"}),e.jsx(c,{name:"description",control:d,render:({field:t})=>e.jsx(ee,{...t,placeholder:"Enter coupon description details...",rows:"3",className:"dark:text-white dark:bg-gray-800"})}),r.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.description.message})]})}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-4",children:[e.jsxs(n,{children:[e.jsx(l,{className:"text-gray-700 dark:text-white",children:"Discount (%) *"}),e.jsx(c,{name:"discount",control:d,render:({field:t})=>e.jsx(m,{...t,type:"number",placeholder:"1-70",min:"1",max:"70",className:"dark:text-white dark:bg-gray-800"})}),r.discount&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.discount.message})]}),e.jsxs(n,{children:[e.jsx(l,{className:"text-gray-700 dark:text-white",children:"Min Purchase Amount (₹) *"}),e.jsx(c,{name:"minAmount",control:d,render:({field:t})=>e.jsx(m,{...t,type:"number",placeholder:"₹500 - ₹1,00,000",min:"500",max:"100000",className:"dark:text-white dark:bg-gray-800"})}),r.minAmount&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.minAmount.message})]}),e.jsxs(n,{children:[e.jsx(l,{className:"text-gray-700 dark:text-white",children:"Max Discount Amount (₹) *"}),e.jsx(c,{name:"maxAmount",control:d,render:({field:t})=>e.jsx(m,{...t,type:"number",placeholder:"₹1 - ₹5,000",min:"1",max:"5000",className:"dark:text-white dark:bg-gray-800"})}),r.maxAmount&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.maxAmount.message})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[e.jsxs(n,{children:[e.jsx(l,{className:"text-gray-700 dark:text-white",children:"Total Usage Limit"}),e.jsx(c,{name:"usageLimit",control:d,render:({field:t})=>e.jsx(m,{...t,type:"number",placeholder:"Leave empty for unlimited (e.g., 10 for first 10 people)",min:"1",className:"dark:text-white dark:bg-gray-800"})}),r.usageLimit&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.usageLimit.message}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:'Set this to limit total uses (e.g., "10" for first 10 people)'})]}),e.jsxs(n,{children:[e.jsx(l,{className:"text-gray-700 dark:text-white",children:"Per User Limit *"}),e.jsx(c,{name:"perUserLimit",control:d,render:({field:t})=>e.jsx(m,{...t,type:"number",placeholder:"1-5",min:"1",max:"5",className:"dark:text-white dark:bg-gray-800"})}),r.perUserLimit&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.perUserLimit.message}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"How many times each user can use this coupon"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs(n,{children:[e.jsx(l,{className:"text-gray-700 dark:text-white",children:"Target Audience"}),e.jsxs("select",{className:"w-full p-3 border rounded-md dark:text-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-orange-500",value:x.length>0?"specific":"all",onChange:t=>{t.target.value==="all"?b([]):h(!0)},children:[e.jsx("option",{value:"all",children:"All Users (Public)"}),e.jsx("option",{value:"specific",children:"Specific Users (Private)"})]}),x.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{onClick:()=>h(!0),className:"w-full p-3 border rounded-md dark:bg-gray-800 dark:text-white text-left cursor-pointer hover:border-orange-500 transition-colors",children:e.jsxs("span",{className:"font-semibold text-orange-600 dark:text-orange-400",children:[x.length," user(s) selected"]})}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:x.map(t=>e.jsxs("span",{className:"inline-flex items-center bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200 text-sm font-medium px-2.5 py-0.5 rounded",children:[t.username,e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),D(t.userId)},className:"ml-1.5 hover:text-red-500",children:"✕"})]},t.userId))})]})]}),e.jsxs(n,{children:[e.jsx(l,{className:"text-gray-700 dark:text-white",children:"Applicable Products"}),e.jsxs("select",{className:"w-full p-3 border rounded-md dark:text-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-orange-500",value:u.length>0?"specific":"all",onChange:t=>{t.target.value==="all"?y([]):j(!0)},children:[e.jsx("option",{value:"all",children:"All Products (Store-wide)"}),e.jsx("option",{value:"specific",children:"Specific Products"})]}),u.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{onClick:()=>j(!0),className:"w-full p-3 border rounded-md dark:bg-gray-800 dark:text-white text-left cursor-pointer hover:border-orange-500 transition-colors",children:e.jsxs("span",{className:"font-semibold text-orange-600 dark:text-orange-400",children:[u.length," product(s) selected"]})}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:u.map(t=>e.jsxs("span",{className:"inline-flex items-center bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200 text-sm font-medium px-2.5 py-0.5 rounded",children:[t.productName,e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),V(t.productId)},className:"ml-1.5 hover:text-red-500",children:"✕"})]},t.productId))})]})]})]}),e.jsx("div",{children:e.jsxs("button",{type:"submit",disabled:v,className:"w-full dark:bg-blue-600 bg-orange-500 text-white px-6 py-3 rounded-md dark:hover:bg-blue-700 hover:bg-orange-600 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(_,{className:"mr-2"}),v?"Creating Coupon...":"Create Coupon"]})})]}),e.jsx(te,{showModal:P,setShowModal:h,users:(f==null?void 0:f.users)||[],handleUserSelect:Q,selectedUsers:x,loadMoreUsers:q,hasMoreUsers:E,isUserFetching:O}),e.jsx(se,{showModal:U,setShowModal:j,products:(N==null?void 0:N.products)||[],handleProductSelect:W,selectedProducts:u,loadMoreProducts:z,hasMoreProducts:T,isProductFetching:R})]})})};export{ue as default};
