import{u as L,ba as q,j as e,L as $,y as G,r as u,ag as A,bC as V,bD as W,aE as Z,a$ as H,B as O}from"./index-DNwfBDY0.js";import{u as J}from"./usePreventBodyScroll-D2l0Zfsl.js";import{A as K}from"./arrow-left-CUel7EGd.js";import{C as X}from"./circle-alert-ogbMB1Si.js";const Y=({order:t,onClose:h,isAdmin:a=!1})=>{var r;const x=L(),{data:d,error:l,isLoading:b}=q(t._id,{skip:!t._id});return J(!!t),b?e.jsx($,{}):l?e.jsxs("p",{className:"text-center text-red-500 dark:text-red-400",children:["Error fetching address details: ",l.message]}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex justify-center items-center z-50 p-4 lg:p-0",children:e.jsxs("div",{className:`${a?"bg-orange-50 dark:bg-gray-900":"bg-white dark:bg-gray-800"} p-4 lg:p-6 rounded-lg shadow-2xl w-full max-w-[90%] lg:w-1/2 max-h-[90vh] overflow-y-auto relative`,children:[e.jsx("button",{onClick:h,className:"absolute top-2 right-2 lg:top-3 lg:right-3 text-gray-500 dark:text-gray-300 hover:text-red-500 dark:hover:text-red-400 transition",children:e.jsx(G,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-xl lg:text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4 lg:mb-6",children:"Order Details"}),e.jsxs("div",{className:`mb-4 lg:mb-6 p-3 lg:p-4 rounded-lg ${a?"shadow-lg border-2 border-indigo-500":"bg-blue-50 dark:bg-gray-700 border border-blue-200 dark:border-blue-900"}`,children:[e.jsx("h3",{className:`text-lg lg:text-xl font-semibold mb-2 lg:mb-4 ${a?"text-indigo-700 dark:text-indigo-400":"text-blue-600 dark:text-blue-400"}`,children:"Order Information"}),e.jsxs("div",{className:"space-y-2 text-gray-700 dark:text-gray-300",children:[e.jsxs("p",{className:"text-sm lg:text-base",children:[e.jsx("strong",{className:"text-gray-900 dark:text-gray-100",children:"Status:"})," ",t.Status]}),e.jsxs("p",{className:"text-sm lg:text-base",children:[e.jsx("strong",{className:"text-gray-900 dark:text-gray-100",children:"Total Amount:"})," â‚¹",t.TotalAmount]}),e.jsxs("p",{className:"text-sm lg:text-base",children:[e.jsx("strong",{className:"text-gray-900 dark:text-gray-100",children:"Order Date:"})," ",new Date(t.createdAt).toLocaleDateString()]})]})]}),d&&e.jsxs("div",{className:`mb-4 lg:mb-6 p-3 lg:p-4 rounded-lg ${a?"shadow-lg border-2 border-green-500":"bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600"}`,children:[e.jsx("h3",{className:`text-lg lg:text-xl font-semibold mb-2 lg:mb-4 ${a?"text-green-700 dark:text-green-400":"text-gray-800 dark:text-gray-100"}`,children:"Shipping Address"}),e.jsxs("div",{className:"space-y-2 text-gray-700 dark:text-gray-300",children:[e.jsxs("p",{className:"text-sm lg:text-base",children:[e.jsx("strong",{className:"text-gray-900 dark:text-gray-100",children:"Street:"})," ",d.street]}),e.jsxs("p",{className:"text-sm lg:text-base",children:[e.jsx("strong",{className:"text-gray-900 dark:text-gray-100",children:"City:"})," ",d.city]}),e.jsxs("p",{className:"text-sm lg:text-base",children:[e.jsx("strong",{className:"text-gray-900 dark:text-gray-100",children:"State:"})," ",d.state]}),e.jsxs("p",{className:"text-sm lg:text-base",children:[e.jsx("strong",{className:"text-gray-900 dark:text-gray-100",children:"Zip Code:"})," ",d.zipCode]}),e.jsxs("p",{className:"text-sm lg:text-base",children:[e.jsx("strong",{className:"text-gray-900 dark:text-gray-100",children:"Country:"})," ",d.country]})]})]}),e.jsxs("div",{className:`mb-4 lg:mb-6 p-3 lg:p-4 rounded-lg ${a?"shadow-lg border-2 border-purple-500":"bg-indigo-50 dark:bg-gray-700 border border-indigo-200 dark:border-indigo-900"}`,children:[e.jsx("h3",{className:`text-lg lg:text-xl font-semibold mb-2 lg:mb-4 ${a?"text-purple-700 dark:text-purple-400":"text-indigo-600 dark:text-indigo-400"}`,children:"Product Information"}),e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center space-y-2 lg:space-y-0 lg:space-x-4",children:[e.jsx("img",{src:t.ProductImage||"/placeholder.svg",alt:t.ProductName,className:`${a?"w-16 h-16 shadow-lg":"w-20 h-20 lg:w-24 lg:h-24 border border-gray-200 dark:border-gray-600"} object-cover rounded-lg`}),e.jsxs("div",{className:"space-y-1 text-gray-700 dark:text-gray-300",children:[e.jsxs("p",{className:"text-sm lg:text-base",children:[e.jsx("strong",{className:"text-gray-900 dark:text-gray-100",children:"Product Name:"})," ",t.ProductName]}),e.jsxs("p",{className:"text-sm lg:text-base",children:[e.jsx("strong",{className:"text-gray-900 dark:text-gray-100",children:"Quantity:"})," ",t.Quantity]}),e.jsxs("p",{className:"text-sm lg:text-base",children:[e.jsx("strong",{className:"text-gray-900 dark:text-gray-100",children:"Price per unit:"})," â‚¹",t.offerPrice]})]})]})]}),e.jsxs("div",{className:"flex justify-end mt-4 lg:mt-6 gap-2",children:[!a&&(t.Status==="Payment Failed"||t.Status==="Failed"||t.paymentStatus==="Failed")&&((r=t.PaymentMethod)==null?void 0:r.toLowerCase())!=="cod"&&e.jsx("button",{onClick:()=>{x("/retry-payment",{state:{orderId:t._id,amount:t.TotalAmount||t.Price*t.Quantity}})},className:"bg-emerald-600 hover:bg-emerald-700 dark:bg-emerald-700 dark:hover:bg-emerald-800 text-white px-4 lg:px-6 py-2 rounded-lg transition duration-300 text-sm lg:text-base shadow-md",children:"Retry Payment"}),e.jsx("button",{onClick:h,className:`${a?"bg-red-400 dark:bg-red-500 hover:bg-red-600 dark:hover:bg-red-700 shadow-lg":"bg-blue-500 dark:bg-blue-600 hover:bg-blue-600 dark:hover:bg-blue-700 shadow-md"} text-white px-4 lg:px-6 py-2 rounded-lg transition duration-300 text-sm lg:text-base`,children:"Close"})]})]})})},ee={Processing:"bg-yellow-200",Shipped:"bg-blue-200","Out for Delivery":"bg-orange-200",Delivered:"bg-green-200",Cancelled:"bg-red-200","Payment Failed":"bg-red-300"},de=()=>{var w,S,P;const[t,h]=u.useState(null),[a,x]=u.useState(1),d=10,[l,b]=u.useState(""),[r,n]=u.useState(""),f=A(),{username:I,email:i}=f.state||{};console.log("ðŸ“§ Email from location:",i);const D=a,{data:c={orders:[]},error:E,isLoading:Q,refetch:F}=V({page:D,limit:d,email:i},{skip:!i||!!r}),{data:g={orders:[]},isLoading:N,error:y,refetch:z}=W({query:r,email:i},{skip:!r||!i});console.log("ðŸ” Search Query State:",{search:l,debouncedSearch:r,email:i,skipCondition:!r||!i,willSkip:!r||!i});const[B]=Z(),T=L();u.useEffect(()=>{const s=setTimeout(()=>{console.log("â±ï¸ Debounce timer fired, setting debouncedSearch to:",l),n(l),l&&i&&console.log("ðŸ” Search triggered:",{search:l,email:i})},500);return()=>clearTimeout(s)},[l,i]);const m=r?g==null?void 0:g.orders:c.orders,v=Q||r&&N,o=E||r&&y;console.log("ðŸ“Š Data State:",{debouncedSearch:r,hasSearchData:!!(g!=null&&g.orders),searchDataLength:(w=g==null?void 0:g.orders)==null?void 0:w.length,hasOrdersData:!!(c!=null&&c.orders),ordersDataLength:(S=c==null?void 0:c.orders)==null?void 0:S.length,displayOrdersLength:m==null?void 0:m.length,isSearchLoading:N,searchError:(y==null?void 0:y.message)||y});const R=async(s,k,U)=>{var C;try{await B({orderId:s,status:k,itemsIds:U}).unwrap(),r?await z():await F(),O.success("Order status updated successfully!")}catch(j){console.error("Error updating order status:",j.message),O.error(((C=j==null?void 0:j.data)==null?void 0:C.message)||"Failed to update order status. Please try again.")}},p=(c==null?void 0:c.totalPages)||1,_=()=>{a<p&&x(s=>s+1)},M=()=>{a>1&&x(s=>s-1)};return e.jsxs("div",{className:"dark:bg-gray-900 py-2 h-screen fixed left-[420px] top-10 right-0 dark:text-white bg-orange-50 px-14 overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 z-20 bg-orange-50 dark:bg-gray-900 py-4 mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>T(-1),className:"flex items-center text-gray-600 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white font-poppins",children:[e.jsx(K,{className:"mr-2"}),e.jsx("span",{children:"Back to Orders"})]}),e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-gray-100 font-playfair",children:[e.jsxs("span",{className:"text-indigo-600",children:[I,"'s"]})," Orders"]})]}),!r&&e.jsxs("div",{className:"flex justify-end items-center gap-3",children:[e.jsx("button",{onClick:M,disabled:a===1,className:`px-4 py-2 rounded-md ${a===1?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,children:"Previous"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-300",children:["Page ",a," / ",p]}),e.jsx("button",{onClick:_,disabled:a===p,className:`px-4 py-2 rounded-md ${a===p?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,children:"Next"})]})]}),e.jsx("div",{className:"mb-4 sticky top-16 z-10 py-4 bg-orange-50 dark:bg-gray-900",children:e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"text",placeholder:"Search by product name or category...",className:"w-full p-3.5 pl-4 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all placeholder:text-gray-400 dark:placeholder:text-gray-500",value:l,onChange:s=>b(s.target.value)}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})}),v&&e.jsx($,{}),o&&e.jsxs("div",{className:"flex items-center justify-center text-red-500 dark:text-red-400",children:[e.jsx(X,{className:"mr-2"}),e.jsx("p",{children:((P=o==null?void 0:o.data)==null?void 0:P.message)||typeof(o==null?void 0:o.error)=="string"&&o.error||((o==null?void 0:o.status)===400?"Invalid search query. Please refine your search.":"Failed to fetch orders. Please try again.")})]}),!v&&!o&&(!m||m.length===0)?e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-400",children:"No orders found."}):e.jsx("ul",{className:"space-y-4",children:m==null?void 0:m.map(s=>e.jsx("li",{className:"p-6 bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg transition ease-in-out shadow-md",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4 md:mb-0",children:[e.jsx("img",{src:s.ProductImage,alt:s.ProductName,className:"w-20 h-20 object-cover rounded-lg shadow-sm"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:s.ProductName}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[s.Quantity," ",s.Quantity===1?"Item":"Items"]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Ordered on:"," ",new Date(s.createdAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex flex-col ml-8 md:flex-row items-start md:items-center gap-3",children:[e.jsx(te,{currentStatus:s.Status,onStatusChange:k=>R(s._id,k,s.itemsIds),disabled:s.Status==="Delivered"||s.Status==="Cancelled"||s.Status==="Returned"}),e.jsx("button",{className:"bg-blue-500 whitespace-nowrap text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition",onClick:()=>h(s),children:"View Details"})]})]})},s._id))}),t&&e.jsx(Y,{order:t,onClose:()=>h(null)})]})},te=({currentStatus:t,onStatusChange:h,disabled:a})=>{const[x,d]=u.useState(!1),l=u.useRef(null),b=["Processing","Shipped","Out for Delivery","Delivered","Cancelled","Payment Failed"];u.useEffect(()=>{const n=f=>{l.current&&!l.current.contains(f.target)&&d(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[]);const r=n=>{n!==t&&h(n),d(!1)};return e.jsxs("div",{className:"relative",ref:l,children:[e.jsxs("button",{className:`flex items-center justify-between w-full px-4 py-2 text-md font-bold dark:text-white ${ee[t]} rounded-md ${a?"opacity-60 cursor-not-allowed":"hover:bg-opacity-80"} focus:outline-none`,onClick:()=>!a&&d(!x),disabled:a,children:[t,e.jsx(H,{className:`ml-2 h-5 w-5 transition-transform ${x?"rotate-180":""}`})]}),x&&!a&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-10",style:{visibility:"visible",opacity:1},children:e.jsx("div",{className:"py-1 z-50",children:b.map(n=>e.jsx("button",{className:`${n===t?"bg-gray-100 text-gray-900":"text-gray-700 hover:bg-gray-200"} block px-4 py-2 text-sm w-full text-left`,onClick:()=>r(n),children:n},n))})})]})};export{de as default};
