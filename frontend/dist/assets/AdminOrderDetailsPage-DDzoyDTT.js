import{j as e,am as P,u as $,r as c,aL as F,B as g,aQ as M,a_ as T,aN as z,aH as U,aA as _,D as B}from"./index-DNwfBDY0.js";import O from"./index-BBTKOM0z.js";import{S as Q,a as q}from"./StatusDropdown-C-KKHdgd.js";const G=({show:o,onClose:h,onConfirm:r,orderId:p,productId:u,reason:x,setReason:b,productName:n,productImage:m,type:d="Cancel"})=>o?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4",children:d==="Return"?"Return Reason":"Cancellation Reason"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4 space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-bold",children:"Order ID:"})," ",p||"N/A"]}),n?e.jsxs("div",{className:"flex items-center gap-3 mt-2 p-2 bg-gray-50 dark:bg-gray-700/50 border border-gray-100 dark:border-gray-600 rounded-lg",children:[m&&e.jsx("img",{src:m,alt:n,className:"w-12 h-12 rounded object-cover border border-gray-200 dark:border-gray-600"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"font-semibold text-gray-800 dark:text-gray-200 truncate",title:n,children:n})})]}):e.jsxs("p",{children:[e.jsx("span",{className:"font-bold",children:"Product ID:"})," ",u||"N/A"]})]}),e.jsx("textarea",{className:"w-full h-24 p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600",value:x,onChange:i=>b(i.target.value),placeholder:`Enter reason for ${d==="Return"?"return":"cancellation"}`}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsxs("button",{onClick:r,className:`px-4 py-2 text-white rounded-md ${d==="Return"?"bg-yellow-500 hover:bg-yellow-600":"bg-red-500 hover:bg-red-600"}`,children:["Confirm ",d]})]})]})}):null,K=()=>{var v,k,w,A,R;const{orderId:o}=P(),h=$(),[r,p]=c.useState(null),[u,x]=c.useState(!0),[b,n]=c.useState(null),[m,d]=c.useState(!1),[i,y]=c.useState(""),[a,j]=c.useState(null);c.useEffect(()=>{f()},[o]);const f=async()=>{try{x(!0);const s=await O.get(`${F}/orders/admin/order-details/${o}`,{withCredentials:!0});s.data.success&&p(s.data.order)}catch(s){console.error("Error fetching order details:",s),g.error("Failed to fetch order details")}finally{x(!1)}},E=async(s,t)=>{if(["Cancelled","Returned"].includes(t)){j({itemId:s,newStatus:t}),d(!0);return}await N(s,t,null)},L=async()=>{if(!i.trim()){g.error("Please provide a reason");return}const{itemId:s,newStatus:t}=a;await N(s,t,i),d(!1),y(""),j(null)},N=async(s,t,C)=>{var I,S;try{n(s),await O.patch(`${F}/orders/update-bulk`,{orderId:r._id,status:t,itemsIds:[s],...C&&{reason:C}},{withCredentials:!0}),g.success("Item status updated successfully!"),await f()}catch(D){console.error("Error updating item status:",D),g.error(((S=(I=D.response)==null?void 0:I.data)==null?void 0:S.message)||"Failed to update status")}finally{n(null)}},l=s=>s?new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return u?e.jsx("div",{className:"flex justify-center items-center min-h-screen dark:bg-gray-900 bg-orange-50",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):r?e.jsxs("div",{className:"dark:bg-gray-900 bg-orange-50 min-h-screen fixed left-[420px] top-10 right-0 bottom-0 overflow-y-auto px-14 py-6 scrollbar-hidden",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>h(-1),className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 mb-4 transition-colors font-semibold",children:[e.jsx(M,{}),e.jsx("span",{children:"Back to Orders"})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:["Order ",r.orderId]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider ${((v=Q[r.orderStatus])==null?void 0:v.color)||"bg-gray-100 text-gray-600"}`,children:r.orderStatus})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1.5 hover:text-blue-600 transition-colors cursor-default",children:[e.jsx(T,{size:12}),e.jsxs("span",{children:[r.userName," (",r.userEmail,")"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(z,{size:12}),e.jsxs("span",{children:["Placed on ",l(r.orderDate)]})]})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-400 uppercase font-bold mb-1",children:"Total Amount"}),e.jsxs("p",{className:"text-2xl font-black text-blue-600",children:["₹",r.totalAmount.toFixed(2)]})]})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4",children:"Order Items"}),e.jsx("div",{className:"space-y-4",children:r.items.map(s=>e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("img",{src:s.productImage,alt:s.productName,className:"w-24 h-24 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-1",children:s.productName}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600 dark:text-gray-400 mb-2",children:[s.color&&s.size&&e.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:[s.color," | ",s.size]}),e.jsxs("span",{children:["Quantity: ",s.quantity]}),e.jsxs("span",{className:"font-semibold text-gray-800 dark:text-gray-200",children:["₹",s.price.toFixed(2)," each"]}),e.jsxs("span",{className:"font-bold text-gray-900 dark:text-gray-100",children:["Total: ₹",s.itemTotal.toFixed(2)]})]}),e.jsx("div",{className:"mb-3",children:e.jsx(q,{currentStatus:s.status,onStatusChange:t=>E(s.itemId,t),isLoading:b===s.itemId})}),(s.confirmedAt||s.shippedAt||s.deliveredAt||s.cancelledAt||s.returnedAt)&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 space-y-1 mb-3",children:[s.confirmedAt&&e.jsxs("p",{children:["✓ Confirmed: ",l(s.confirmedAt)]}),s.shippedAt&&e.jsxs("p",{children:["✓ Shipped: ",l(s.shippedAt)]}),s.deliveredAt&&e.jsxs("p",{children:["✓ Delivered: ",l(s.deliveredAt)]}),s.cancelledAt&&e.jsxs("p",{children:["✗ Cancelled: ",l(s.cancelledAt)]}),s.returnedAt&&e.jsxs("p",{children:["↩ Returned: ",l(s.returnedAt)]})]}),s.cancellationReason&&e.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400 mb-2",children:["Cancellation Reason: ",s.cancellationReason]}),s.returnReason&&e.jsxs("p",{className:"text-sm text-purple-600 dark:text-purple-400 mb-2",children:["Return Reason: ",s.returnReason]}),s.refundAmount>0&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400 mb-2",children:[e.jsxs("p",{children:["Refund: ₹",s.refundAmount.toFixed(2)," (",s.refundStatus,")"]}),s.refundedAt&&e.jsxs("p",{className:"text-xs",children:["Refunded on: ",l(s.refundedAt)]})]}),s.trackingNumber&&e.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:["Tracking: ",s.trackingNumber]})]})]})},s.itemId))})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4",children:"Order Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["₹",r.subtotal.toFixed(2)]})]}),r.couponDiscount>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Coupon Discount"}),e.jsxs("span",{children:["-₹",r.couponDiscount.toFixed(2)]})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",r.totalAmount.toFixed(2)]})]})}),r.refundAmount>0&&e.jsxs("div",{className:"flex justify-between text-green-600 mt-2",children:[e.jsx("span",{children:"Refunded"}),e.jsxs("span",{children:["₹",r.refundAmount.toFixed(2)]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2",children:[e.jsx(U,{}),e.jsxs("span",{children:["Payment Method: ",r.paymentMethod||"N/A"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(_,{className:"text-green-500"}),e.jsx("span",{className:`${r.paymentStatus==="Completed"?"text-green-600":"text-yellow-600"}`,children:r.paymentStatus})]})]}),r.expectedDeliveryDate&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Expected Delivery"}),e.jsx("p",{className:"font-semibold",children:l(r.expectedDeliveryDate)})]})]}),r.shippingAddress&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(B,{className:"text-blue-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:"Shipping Address"})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-2",children:[e.jsxs("div",{className:"flex border-b border-gray-100 dark:border-gray-700 pb-1",children:[e.jsx("span",{className:"w-16 flex-shrink-0 text-gray-500",children:"Name:"}),e.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-200",children:r.shippingAddress.name})]}),e.jsxs("div",{className:"flex border-b border-gray-100 dark:border-gray-700 pb-1",children:[e.jsx("span",{className:"w-16 flex-shrink-0 text-gray-500",children:"Street:"}),e.jsxs("span",{children:[r.shippingAddress.street||r.shippingAddress.addressLine1,r.shippingAddress.addressLine2&&`, ${r.shippingAddress.addressLine2}`]})]}),e.jsxs("div",{className:"flex border-b border-gray-100 dark:border-gray-700 pb-1",children:[e.jsx("span",{className:"w-16 flex-shrink-0 text-gray-500",children:"City:"}),e.jsx("span",{children:r.shippingAddress.city})]}),e.jsxs("div",{className:"flex border-b border-gray-100 dark:border-gray-700 pb-1",children:[e.jsx("span",{className:"w-16 flex-shrink-0 text-gray-500",children:"State:"}),e.jsx("span",{children:r.shippingAddress.state})]}),e.jsxs("div",{className:"flex border-b border-gray-100 dark:border-gray-700 pb-1",children:[e.jsx("span",{className:"w-16 flex-shrink-0 text-gray-500",children:"Zip:"}),e.jsx("span",{children:r.shippingAddress.zipCode||r.shippingAddress.pincode})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"w-16 flex-shrink-0 text-gray-500",children:"Phone:"}),e.jsx("span",{children:r.shippingAddress.phone})]})]})]})]})]}),e.jsx(G,{show:m,onClose:()=>{d(!1),y(""),j(null)},onConfirm:L,orderId:r==null?void 0:r.orderId,productId:a==null?void 0:a.itemId,productName:(w=(k=r==null?void 0:r.items)==null?void 0:k.find(s=>s.itemId===(a==null?void 0:a.itemId)))==null?void 0:w.productName,productImage:(R=(A=r==null?void 0:r.items)==null?void 0:A.find(s=>s.itemId===(a==null?void 0:a.itemId)))==null?void 0:R.productImage,reason:i,setReason:y,type:(a==null?void 0:a.newStatus)==="Returned"?"Return":"Cancel"})]}):e.jsx("div",{className:"dark:bg-gray-900 bg-orange-50 min-h-screen p-6",children:e.jsx("p",{className:"text-center text-gray-600",children:"Order not found"})})};export{K as default};
